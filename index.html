<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eagles Analytics - Game Logs</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        :root { --gold: #FFB81C; --black: #050505; --red: #ef4444; --green: #22c55e; --blue: #3b82f6; --zinc: #18181b; }
        body { background-color: var(--black); color: white; font-family: system-ui, -apple-system, sans-serif; -webkit-print-color-adjust: exact; }
        
        /* UI COMPONENTS */
        .bento-card { 
            background: rgba(30, 30, 30, 0.7); backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.08); border-radius: 16px; padding: 1.25rem; 
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3); transition: transform 0.2s;
        }
        .bento-card:hover { border-color: var(--gold); }
        
        .nav-btn { font-size: 10px; font-weight: 800; text-transform: uppercase; padding: 10px 14px; border-radius: 99px; cursor: pointer; border: 1px solid transparent; transition: all 0.2s; white-space: nowrap; }
        .active-nav { background-color: var(--gold); color: black; box-shadow: 0 0 15px rgba(255, 184, 28, 0.3); }
        .inactive-nav { background: rgba(255,255,255,0.05); color: #888; }
        .inactive-nav:hover { background: rgba(255,255,255,0.1); color: white; }

        .stat-input { background: #111; border: 1px solid #333; color: white; padding: 4px; text-align: center; border-radius: 6px; width: 100%; font-weight: bold; }
        .court-svg { width: 100%; display: block; margin: 0 auto; filter: drop-shadow(0 0 8px rgba(255,184,28,0.1)); }
        .zone { cursor: pointer; transition: 0.2s; opacity: 0.3; stroke: rgba(255,255,255,0.4); stroke-width: 0.8; fill: transparent; }
        .zone:hover { opacity: 0.6; stroke: white; }

        .stat-table th { position: sticky; top: 0; background: #111; z-index: 10; font-size: 10px; text-transform: uppercase; color: #888; padding: 10px; cursor: pointer; }
        .stat-table th:hover { color: var(--gold); }
        .stat-row:hover { background: rgba(255,255,255,0.05); }

        /* PRINT STYLES */
        @media print {
            body { background: white; color: black; }
            .no-print { display: none !important; }
            .bento-card { background: white; border: 2px solid #000; color: black; box-shadow: none; break-inside: avoid; }
            .text-gold { color: #000 !important; }
            .text-zinc-500, .text-zinc-400 { color: #444 !important; }
            .bg-black { background: white; border: 1px solid #ccc; color: black; }
            .print-header { display: block !important; border-bottom: 2px solid black; margin-bottom: 20px; padding-bottom: 10px; }
            .print-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        }
        .print-header { display: none; }
    </style>
</head>
<body>
    <div id="root">
        <div style="height: 100vh; display: flex; align-items: center; justify-content: center; color: #FFB81C; font-weight: bold; font-size: 24px; animation: pulse 2s infinite;">
            BOOTING MASTER SYSTEM...
        </div>
    </div>

    <script type="text/babel">
        // --- CONFIG ---
        const ROSTER = [
            {id: 5, name: "Natasha Mistry", pos: "PG"}, {id: 3, name: "Mikayla Sanders", pos: "PG"}, 
            {id: 22, name: "Christina Lisack", pos: "PG/G"}, {id: 1, name: "Brittney Tang", pos: "G"},
            {id: 2, name: "Kylie Mulcahy", pos: "G"}, {id: 4, name: "Lexi Guild", pos: "G"},
            {id: 10, name: "Reese Jackson", pos: "F"}, {id: 32, name: "Gia Comey", pos: "F"}, 
            {id: 23, name: "Olivia Dozier", pos: "G/F"}, {id: 44, name: "Olivia Fraser", pos: "G/F"},
            {id: 34, name: "Dani Cardona", pos: "C"}, {id: 15, name: "Alexa Troiano", pos: "C"},
            {id: 0, name: "Bela Smith", pos: "G/F"}
        ];
        const STAT_FIELDS = ['fg2m','fg2a','fg3m','fg3a','ftm','fta','reb','ast','stl','blk','to'];
        const ZONES = ['paint', 'mid_l', 'mid_r', 'mid_c', 'corn_l', 'corn_r', 'wing_l', 'wing_r', 'top'];

        // --- MAIN APP ---
        function App() {
            const [view, setView] = React.useState('clipboard');
            const [games, setGames] = React.useState([]);
            const [loading, setLoading] = React.useState(true);
            const [db, setDb] = React.useState(null);

            // DATA ENTRY & STATE
            const [gameMeta, setGameMeta] = React.useState({ date: new Date().toISOString().split('T')[0], opp: '', oppScore: 0, venue: 'Home' });
            const [playerStats, setPlayerStats] = React.useState({});
            const [shotMap, setShotMap] = React.useState({ eagles: ZONES.reduce((a,z)=>({...a,[z]:{m:0,x:0}}), {}), opp: {} });
            const [playStats, setPlayStats] = React.useState([
                { id: 'trans', name: 'TRANSITION', att: 0, made: 0, pts: 0 },
                { id: 'broken', name: 'BROKEN PLAY', att: 0, made: 0, pts: 0 },
                { id: 'motion', name: 'Motion Offense', att: 0, made: 0, pts: 0 }
            ]);
            const [newPlayName, setNewPlayName] = React.useState('');
            const [shotMode, setShotMode] = React.useState('make');
            const [editId, setEditId] = React.useState(null);

            // FILTERS
            const [selectedPlayer, setSelectedPlayer] = React.useState(ROSTER[0].name);
            const [sortConfig, setSortConfig] = React.useState({ key: 'ppg', direction: 'desc' });
            const [tacticsFilter, setTacticsFilter] = React.useState('season');
            const [searchQuery, setSearchQuery] = React.useState('');
            const [recapGame, setRecapGame] = React.useState(null); // For Game Report View

            // INIT
            React.useEffect(() => {
                try {
                    const firebaseConfig = { apiKey: "AIzaSyA5H5SsumWG7bym_0EZ7jOlfWeswpSauhk", projectId: "eagles-stats", appId: "1:386723096734:web:b50e343c703983e838b38f" };
                    if(window.firebase && !firebase.apps.length) { firebase.initializeApp(firebaseConfig); }
                    const d = firebase.firestore();
                    setDb(d);
                    d.collection('games').orderBy('date', 'desc').onSnapshot(snap => {
                        setGames(snap.docs.map(doc => ({ id: doc.id, ...doc.data() })));
                        setLoading(false);
                    });
                } catch(e) { console.warn("Offline"); setLoading(false); }
            }, []);

            // --- ACTIONS ---
            const saveGame = async () => {
                if(!db) return alert("Offline Mode");
                if(!gameMeta.opp) return alert("Enter Opponent Name");
                let tScore = 0;
                const stats = ROSTER.map(p => {
                    const s = playerStats[p.name] || {};
                    const pts = ((s.fg2m||0)*2)+((s.fg3m||0)*3)+(s.ftm||0);
                    tScore += pts;
                    return { ...p, ...s, pts };
                });
                const payload = { ...gameMeta, teamScore: tScore, stats, shotMap, playStats, result: tScore>gameMeta.oppScore?'W':'L', updatedAt: firebase.firestore.FieldValue.serverTimestamp() };
                try {
                    if(editId) await db.collection('games').doc(editId).update(payload);
                    else await db.collection('games').add(payload);
                    alert("Saved!"); setEditId(null); setView('log');
                } catch(e) { alert("Error: "+e.message); }
            };

            const deleteGame = async (id, opp) => {
                if(!db) return alert("Offline");
                if(confirm(`Are you sure you want to delete the game vs ${opp}? This cannot be undone.`)) {
                    await db.collection('games').doc(id).delete();
                }
            };

            const loadGameForEdit = (g) => {
                setEditId(g.id);
                setGameMeta({date:g.date, opp:g.opp, oppScore:g.oppScore, venue:g.venue});
                setPlayStats(g.playStats||[]);
                const sm={}; g.stats.forEach(s=>sm[s.name]=s); setPlayerStats(sm);
                setShotMap(g.shotMap || { eagles: ZONES.reduce((a,z)=>({...a,[z]:{m:0,x:0}}), {}), opp: {} });
                setView('new');
            };

            const openRecap = (g) => {
                setRecapGame(g);
                setView('recap');
            };

            const handlePlayUpdate = (index, points) => { const newPlays = [...playStats]; newPlays[index].att += 1; if (points > 0) { newPlays[index].made += 1; newPlays[index].pts += points; } setPlayStats(newPlays); };
            const handleSort = (key) => setSortConfig({ key, direction: sortConfig.key === key && sortConfig.direction === 'desc' ? 'asc' : 'desc' });

            // --- DATA HELPERS (Condensed) ---
            const filteredGames = games.filter(g => g.opp.toLowerCase().includes(searchQuery.toLowerCase()));

            if(loading) return <div className="p-20 text-center text-gold font-bold">LOADING DATA...</div>;

            return (
                <div className="pb-24 max-w-7xl mx-auto p-4">
                    {/* NAV HEADER */}
                    <div className="flex flex-col md:flex-row justify-between items-center mb-6 bg-zinc-900 p-4 rounded-xl border border-white/10 sticky top-2 z-50 shadow-xl no-print">
                        <div className="flex items-center gap-2 mb-4 md:mb-0">
                            <span className="text-2xl">ü¶Ö</span>
                            <h1 className="text-xl font-black italic uppercase">Eagles <span className="text-gold">Analytics</span></h1>
                        </div>
                        <nav className="flex gap-1 overflow-x-auto w-full md:w-auto pb-1 no-scrollbar">
                            {['clipboard', 'new', 'tactics', 'stats', 'profiles', 'log'].map(t => (
                                <button key={t} onClick={()=>setView(t)} className={`nav-btn ${view===t?'active-nav':'inactive-nav'}`}>{t}</button>
                            ))}
                        </nav>
                    </div>

                    {/* --- VIEW: LOG (UPDATED) --- */}
                    {view === 'log' && (
                        <div className="space-y-6 animate-slideIn">
                            {/* Search Bar */}
                            <div className="bento-card flex gap-4 items-center p-3">
                                <span className="text-xl">üîç</span>
                                <input placeholder="Search opponents..." value={searchQuery} onChange={e=>setSearchQuery(e.target.value)} className="bg-transparent border-none outline-none text-white font-bold w-full uppercase placeholder-zinc-600" />
                            </div>

                            {/* Game List */}
                            <div className="grid gap-4">
                                {filteredGames.map(g => (
                                    <div key={g.id} className="bento-card group flex flex-col md:flex-row justify-between items-center gap-4 border-l-4" style={{borderLeftColor: g.result==='W'?'var(--green)':'var(--red)'}}>
                                        
                                        {/* Result Badge */}
                                        <div className="flex items-center gap-6 w-full md:w-auto">
                                            <div className={`w-16 h-16 rounded-xl flex items-center justify-center text-3xl font-black italic ${g.result==='W'?'bg-green-900/30 text-green-400':'bg-red-900/30 text-red-400'}`}>
                                                {g.result}
                                            </div>
                                            <div>
                                                <div className="text-[10px] font-black uppercase text-zinc-500 tracking-widest">{g.date} ‚Ä¢ {g.venue}</div>
                                                <div className="text-2xl font-black italic uppercase">{g.opp}</div>
                                                <div className="text-sm font-bold text-zinc-300">Eagles {g.teamScore} - {g.oppScore} Opp</div>
                                            </div>
                                        </div>

                                        {/* Actions */}
                                        <div className="flex gap-2 w-full md:w-auto">
                                            <button onClick={()=>openRecap(g)} className="flex-1 md:flex-none px-4 py-2 bg-blue-900/20 text-blue-400 border border-blue-900 rounded-lg text-xs font-black uppercase hover:bg-blue-900/40 transition">üìÑ Report</button>
                                            <button onClick={()=>loadGameForEdit(g)} className="flex-1 md:flex-none px-4 py-2 bg-zinc-800 text-zinc-400 border border-zinc-700 rounded-lg text-xs font-black uppercase hover:bg-white hover:text-black transition">‚úèÔ∏è Edit</button>
                                            <button onClick={()=>deleteGame(g.id, g.opp)} className="px-4 py-2 bg-red-900/20 text-red-500 border border-red-900 rounded-lg text-xs font-black uppercase hover:bg-red-900/40 transition">üóëÔ∏è</button>
                                        </div>
                                    </div>
                                ))}
                                {filteredGames.length === 0 && <div className="text-center py-20 text-zinc-500 italic">No games found matching "{searchQuery}"</div>}
                            </div>
                        </div>
                    )}

                    {/* --- VIEW: GAME RECAP (NEW) --- */}
                    {view === 'recap' && recapGame && (
                        <div className="animate-slideIn">
                            <div className="mb-4 no-print"><button onClick={()=>setView('log')} className="text-xs font-bold text-zinc-500 hover:text-white mb-4">‚Üê BACK TO LOG</button></div>
                            
                            {/* PRINT HEADER */}
                            <div className="print-header">
                                <h1 className="text-4xl font-black uppercase">Game Recap</h1>
                                <p className="text-lg">vs {recapGame.opp} ({recapGame.date})</p>
                            </div>

                            {/* SCOREBOARD */}
                            <div className="bento-card mb-6">
                                <div className="flex justify-between items-center text-center">
                                    <div className="flex-1"><div className="text-sm font-bold text-zinc-500">EAGLES</div><div className="text-6xl font-black italic text-gold">{recapGame.teamScore}</div></div>
                                    <div className="text-2xl font-black text-zinc-700">vs</div>
                                    <div className="flex-1"><div className="text-sm font-bold text-zinc-500 uppercase">{recapGame.opp}</div><div className="text-6xl font-black italic text-white">{recapGame.oppScore}</div></div>
                                </div>
                            </div>

                            <div className="print-grid grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                                {/* FOUR FACTORS (Approximated) */}
                                <div className="bento-card">
                                    <h3 className="text-sm font-black text-gold uppercase mb-4 border-b border-white/10 pb-2">Key Factors</h3>
                                    <div className="grid grid-cols-2 gap-4">
                                        <StatBox label="FG%" val={(() => { let m=0,a=0; recapGame.stats.forEach(s=>{m+=s.fg2m+s.fg3m; a+=s.fg2a+s.fg3a}); return a>0?Math.round((m/a)*100)+'%':0; })()} />
                                        <StatBox label="3PT%" val={(() => { let m=0,a=0; recapGame.stats.forEach(s=>{m+=s.fg3m; a+=s.fg3a}); return a>0?Math.round((m/a)*100)+'%':0; })()} />
                                        <StatBox label="Turnovers" val={recapGame.stats.reduce((a,b)=>a+(b.to||0),0)} color="text-red-400" />
                                        <StatBox label="Rebounds" val={recapGame.stats.reduce((a,b)=>a+(b.reb||0),0)} />
                                    </div>
                                </div>
                                {/* SHOT CHART */}
                                <div className="bento-card">
                                    <h3 className="text-sm font-black text-gold uppercase mb-4 border-b border-white/10 pb-2">Shot Chart</h3>
                                    <HeatMapCourt data={recapGame.shotMap.eagles} />
                                </div>
                            </div>

                            {/* BOX SCORE */}
                            <div className="bento-card overflow-hidden">
                                <h3 className="text-sm font-black text-gold uppercase mb-4 pl-4">Box Score</h3>
                                <div className="overflow-x-auto">
                                    <table className="w-full text-left stat-table">
                                        <thead><tr><th>Player</th><th>PTS</th><th>REB</th><th>AST</th><th>STL</th><th>BLK</th><th>TO</th><th>FG</th><th>3PT</th><th>FT</th></tr></thead>
                                        <tbody className="text-xs font-bold divide-y divide-white/5">
                                            {recapGame.stats.sort((a,b)=>b.pts-a.pts).map(s => (
                                                <tr key={s.name} className="stat-row">
                                                    <td className="p-3 bg-zinc-900/50 sticky left-0">{s.name}</td>
                                                    <td className="p-3 text-gold">{((s.fg2m*2)+(s.fg3m*3)+s.ftm)}</td>
                                                    <td className="p-3">{s.reb}</td><td className="p-3">{s.ast}</td>
                                                    <td className="p-3">{s.stl}</td><td className="p-3">{s.blk}</td>
                                                    <td className="p-3 text-zinc-500">{s.to}</td>
                                                    <td className="p-3">{s.fg2m+s.fg3m}/{s.fg2a+s.fg3a}</td>
                                                    <td className="p-3">{s.fg3m}/{s.fg3a}</td>
                                                    <td className="p-3">{s.ftm}/{s.fta}</td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            
                            <div className="mt-8 text-center no-print">
                                <button onClick={()=>window.print()} className="bg-white text-black px-8 py-3 rounded-full font-black uppercase shadow-lg hover:bg-gold transition">üñ®Ô∏è Print Game Report</button>
                            </div>
                        </div>
                    )}

                    {/* --- OTHER VIEWS (Standard) --- */}
                    {view === 'clipboard' && <ClipboardView games={games} />}
                    {view === 'new' && (
                        <div className="space-y-6">
                            <div className="bento-card grid grid-cols-2 md:grid-cols-4 gap-4">
                                <div className="space-y-1"><label className="text-[9px] font-bold text-zinc-500 uppercase">Opponent</label><input className="w-full bg-black border border-zinc-700 p-2 rounded text-white font-bold" value={gameMeta.opp} onChange={e=>setGameMeta({...gameMeta, opp:e.target.value})} /></div>
                                <div className="space-y-1"><label className="text-[9px] font-bold text-zinc-500 uppercase">Opp Score</label><input type="number" className="w-full bg-black border border-zinc-700 p-2 rounded text-white font-bold" value={gameMeta.oppScore} onChange={e=>setGameMeta({...gameMeta, oppScore:parseInt(e.target.value)||0})} /></div>
                                <div className="space-y-1"><label className="text-[9px] font-bold text-zinc-500 uppercase">Date</label><input type="date" className="w-full bg-black border border-zinc-700 p-2 rounded text-white font-bold" value={gameMeta.date} onChange={e=>setGameMeta({...gameMeta, date:e.target.value})} /></div>
                                <div className="space-y-1"><label className="text-[9px] font-bold text-zinc-500 uppercase">Venue</label><select className="w-full bg-black border border-zinc-700 p-2 rounded text-white font-bold" value={gameMeta.venue} onChange={e=>setGameMeta({...gameMeta, venue:e.target.value})}><option>Home</option><option>Away</option></select></div>
                            </div>
                            <div className="grid grid-cols-1 lg:grid-cols-12 gap-6">
                                <div className="lg:col-span-4 bento-card border-t-4 border-gold">
                                    <h3 className="font-black text-gold uppercase mb-4">Playbook</h3>
                                    <div className="space-y-2">{playStats.map((p,i)=>(<div key={i} className="flex items-center gap-2 p-2 border-b border-white/5"><div className="flex-1 font-bold text-xs uppercase">{p.name}</div><button onClick={()=>handlePlayUpdate(i,0)} className="px-2 py-1 bg-zinc-800 rounded text-[10px] hover:bg-red-900/50">Stop</button><button onClick={()=>handlePlayUpdate(i,2)} className="px-2 py-1 bg-zinc-800 rounded text-[10px] hover:bg-blue-900/50">+2</button><button onClick={()=>handlePlayUpdate(i,3)} className="px-2 py-1 bg-zinc-800 rounded text-[10px] hover:bg-green-900/50">+3</button></div>))}</div>
                                    <div className="flex gap-2 mt-4"><input className="bg-black border border-zinc-700 rounded p-2 text-xs flex-1 text-white font-bold" placeholder="New Play..." value={newPlayName} onChange={e=>setNewPlayName(e.target.value)} /><button onClick={()=>{if(newPlayName){setPlayStats([...playStats,{id:Date.now(),name:newPlayName,att:0,made:0,pts:0}]);setNewPlayName('');}}} className="bg-gold text-black font-bold text-xs px-3 rounded uppercase">Add</button></div>
                                </div>
                                <div className="lg:col-span-8 bento-card">
                                    <div className="flex justify-between mb-4"><h3 className="font-black text-gold uppercase">Input</h3><div className="flex bg-black rounded border border-zinc-800 p-1"><button onClick={()=>setShotMode('make')} className={`px-3 py-1 text-[10px] font-black uppercase rounded ${shotMode==='make'?'bg-green-600 text-white':'text-zinc-500'}`}>Make</button><button onClick={()=>setShotMode('miss')} className={`px-3 py-1 text-[10px] font-black uppercase rounded ${shotMode==='miss'?'bg-red-600 text-white':'text-zinc-500'}`}>Miss</button></div></div>
                                    <InteractiveCourt data={shotMap.eagles} mode={shotMode} onClick={(z,m)=>{const c=shotMap.eagles[z]||{m:0,x:0};setShotMap({...shotMap,eagles:{...shotMap.eagles,[z]:{m:c.m+(m?1:0),x:c.x+(m?0:1)}}})}} />
                                    <div className="overflow-x-auto mt-4"><table className="w-full text-xs"><thead><tr className="text-zinc-500 border-b border-zinc-800"><th className="p-2 text-left">PLAYER</th>{STAT_FIELDS.map(f=><th key={f} className="p-1 uppercase text-center">{f.replace('fg','').replace('m','')}</th>)}</tr></thead><tbody>{ROSTER.map(p=>{const s=playerStats[p.name]||{};return(<tr key={p.id} className="border-b border-white/5"><td className="p-2 font-bold whitespace-nowrap">{p.name}</td>{STAT_FIELDS.map(f=><td key={f} className="p-1"><input type="number" className="stat-input" value={s[f]||''} onChange={e=>setPlayerStats({...playerStats,[p.name]:{...s,[f]:parseInt(e.target.value)||0}})}/></td>)}</tr>)})}</tbody></table></div>
                                </div>
                            </div>
                            <button onClick={saveGame} className="w-full py-4 bg-gold hover:bg-white text-black font-black uppercase text-xl rounded-xl shadow-lg transition-all">Save Game</button>
                        </div>
                    )}
                    {view === 'tactics' && <TacticsView games={games} filter={tacticsFilter} setFilter={setTacticsFilter} />}
                    {view === 'stats' && <StatsView games={games} />}
                    {view === 'profiles' && <ProfilesView games={games} />}
                </div>
            );
        }

        // --- SUB-VIEWS (Extracted for cleaner main render) ---
        function ClipboardView({games}) {
            // Re-using logic from previous steps to calculate aggregated stats
            const totalGames = games.length || 1;
            const totals = { pts:0, opp:0, reb:0, ast:0, stocks:0, to:0 };
            const pMap = {};
            ROSTER.forEach(p => pMap[p.name] = { name: p.name, gp:0, pts:0, reb:0, fg3m:0, fg3a:0, ftm:0, fta:0 });
            games.forEach(g => {
                totals.pts+=g.teamScore; totals.opp+=g.oppScore;
                g.stats.forEach(s => {
                    totals.reb+=(s.reb||0); totals.ast+=(s.ast||0); totals.stocks+=((s.stl||0)+(s.blk||0)); totals.to+=(s.to||0);
                    if(pMap[s.name]) { const p=pMap[s.name]; p.gp++; p.pts+=((s.fg2m*2)+(s.fg3m*3)+s.ftm); p.reb+=(s.reb||0); p.fg3m+=(s.fg3m||0); p.fg3a+=(s.fg3a||0); p.ftm+=(s.ftm||0); p.fta+=(s.fta||0); }
                });
            });
            const players = Object.values(pMap).filter(p=>p.gp>0);
            return (
                <div className="space-y-6 animate-slideIn">
                    <div className="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-7 gap-3">
                        <MiniStat label="Record" value={`${games.filter(g=>g.result==='W').length}-${games.filter(g=>g.result==='L').length}`} />
                        <MiniStat label="PPG" value={(totals.pts/totalGames).toFixed(1)} color="text-gold" />
                        <MiniStat label="Opp PPG" value={(totals.opp/totalGames).toFixed(1)} color="text-red-400" />
                        <MiniStat label="RPG" value={(totals.reb/totalGames).toFixed(1)} />
                        <MiniStat label="APG" value={(totals.ast/totalGames).toFixed(1)} />
                        <MiniStat label="Stocks" value={(totals.stocks/totalGames).toFixed(1)} />
                        <MiniStat label="TO/G" value={(totals.to/totalGames).toFixed(1)} color="text-zinc-400" />
                    </div>
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                        <Leaderboard title="Scoring" icon="üî•" players={[...players].sort((a,b)=>(b.pts/b.gp)-(a.pts/a.gp)).slice(0,3)} valFunc={p=>(p.pts/p.gp).toFixed(1)} label="PPG" />
                        <Leaderboard title="Rebounding" icon="üí™" players={[...players].sort((a,b)=>(b.reb/b.gp)-(a.reb/a.gp)).slice(0,3)} valFunc={p=>(p.reb/p.gp).toFixed(1)} label="RPG" />
                        <Leaderboard title="3PT %" icon="üéØ" players={[...players].filter(p=>p.fg3a>2).sort((a,b)=>(b.fg3m/b.fg3a)-(a.fg3m/a.fg3a)).slice(0,3)} valFunc={p=>Math.round((p.fg3m/p.fg3a)*100)+'%'} label="3PT%" />
                        <Leaderboard title="Free Throw" icon="üîí" players={[...players].filter(p=>p.fta>2).sort((a,b)=>(b.ftm/b.fta)-(a.ftm/a.fta)).slice(0,3)} valFunc={p=>Math.round((p.ftm/p.fta)*100)+'%'} label="FT%" />
                    </div>
                </div>
            )
        }
        function TacticsView({games, filter, setFilter}) {
             let target = filter === 'season' ? games : games.filter(g => g.id === filter);
             const aggPlays = {}; const aggMap = ZONES.reduce((a,z)=>({...a,[z]:{m:0,x:0}}),{});
             target.forEach(g=>{ if(g.playStats) g.playStats.forEach(p=>{ if(!aggPlays[p.name])aggPlays[p.name]={name:p.name,att:0,made:0,pts:0}; aggPlays[p.name].att+=p.att;aggPlays[p.name].made+=p.made;aggPlays[p.name].pts+=(p.pts||p.made*2); }); if(g.shotMap) ZONES.forEach(z=>{ aggMap[z].m+=(g.shotMap.eagles[z]?.m||0); aggMap[z].x+=(g.shotMap.eagles[z]?.x||0); }); });
             return (
                 <div className="space-y-6 animate-slideIn">
                    <div className="bg-zinc-900 p-3 rounded flex gap-4"><select value={filter} onChange={e=>setFilter(e.target.value)} className="bg-black border border-zinc-700 p-2 text-xs font-bold rounded flex-1"><option value="season">Full Season</option>{games.map(g=><option key={g.id} value={g.id}>{g.date} vs {g.opp}</option>)}</select></div>
                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-6"><div className="bento-card"><h3 className="text-gold font-black uppercase mb-4">Play Efficiency</h3>{Object.values(aggPlays).sort((a,b)=>b.pts/b.att-a.pts/a.att).map((p,i)=>(<div key={i} className="flex justify-between p-2 border-b border-white/5 text-xs"><span className="font-bold">{p.name}</span><span>{(p.pts/p.att||0).toFixed(2)} PPP</span></div>))}</div><div className="bento-card"><h3 className="text-gold font-black uppercase mb-4">Shot Heat Map</h3><HeatMapCourt data={aggMap}/></div></div>
                 </div>
             )
        }
        function StatsView({games}) {
            const totals = {}; ROSTER.forEach(p => totals[p.name] = { name: p.name, gp:0, pts:0, reb:0, ast:0, stl:0, blk:0, to:0 });
            games.forEach(g => g.stats.forEach(s => { if(totals[s.name]) { const t=totals[s.name]; t.gp++; t.pts+=((s.fg2m*2)+(s.fg3m*3)+s.ftm); t.reb+=(s.reb||0); t.ast+=(s.ast||0); t.stl+=(s.stl||0); t.blk+=(s.blk||0); t.to+=(s.to||0); } }));
            return <div className="bento-card overflow-x-auto animate-slideIn"><table className="w-full text-left stat-table"><thead><tr><th>Player</th><th>PPG</th><th>RPG</th><th>APG</th><th>SPG</th><th>BPG</th><th>TO</th></tr></thead><tbody className="text-xs font-bold divide-y divide-white/5">{Object.values(totals).sort((a,b)=>(b.pts/b.gp)-(a.pts/a.gp)).map(p=>{ const g=p.gp||1; return <tr key={p.name} className="stat-row"><td className="p-3 bg-zinc-900/50 sticky left-0">{p.name}</td><td className="p-3 text-gold">{(p.pts/g).toFixed(1)}</td><td className="p-3">{(p.reb/g).toFixed(1)}</td><td className="p-3">{(p.ast/g).toFixed(1)}</td><td className="p-3">{(p.stl/g).toFixed(1)}</td><td className="p-3">{(p.blk/g).toFixed(1)}</td><td className="p-3 text-zinc-500">{(p.to/g).toFixed(1)}</td></tr> })}</tbody></table></div>
        }
        function ProfilesView({games}) {
            const [selected, setSelected] = React.useState(ROSTER[0].name);
            const pGames = games.filter(g=>g.stats.find(s=>s.name===selected));
            let pts=0, reb=0, ast=0; pGames.forEach(g=>{ const s=g.stats.find(x=>x.name===selected); pts+=((s.fg2m*2)+(s.fg3m*3)+s.ftm); reb+=(s.reb||0); ast+=(s.ast||0); });
            const g = pGames.length||1;
            return (
                <div className="animate-slideIn">
                    <div className="mb-6 overflow-x-auto pb-2 no-print"><div className="flex gap-2">{ROSTER.map(p=>(<button key={p.id} onClick={()=>setSelected(p.name)} className={`px-4 py-2 rounded-lg text-xs font-bold uppercase border ${selected===p.name?'bg-white text-black':'bg-black text-zinc-500'}`}>{p.name}</button>))}</div></div>
                    <div className="print-header"><h1 className="text-4xl font-black uppercase">Profile: {selected}</h1></div>
                    <div className="bento-card mb-6"><h2 className="text-4xl font-black italic uppercase">{selected}</h2><div className="text-sm font-bold text-zinc-500">{pGames.length} Games ‚Ä¢ {(pts/g).toFixed(1)} PPG</div></div>
                    <div className="grid grid-cols-3 gap-4"><StatBox label="PPG" val={(pts/g).toFixed(1)} color="text-gold" /><StatBox label="RPG" val={(reb/g).toFixed(1)} /><StatBox label="APG" val={(ast/g).toFixed(1)} /></div>
                    <div className="mt-8 text-center no-print"><button onClick={()=>window.print()} className="bg-white text-black px-6 py-2 rounded-full font-bold uppercase text-xs">üñ®Ô∏è PDF Report</button></div>
                </div>
            )
        }

        // --- VISUALS ---
        function MiniStat({label, value, color, sub}) { return (<div className="bento-card flex flex-col items-center justify-center py-4"><div className="text-[9px] font-black uppercase text-zinc-500 tracking-widest mb-1">{label}</div><div className={`text-2xl font-black italic tracking-tighter ${color||'text-white'}`}>{value}</div>{sub && <div className="text-[8px] text-zinc-600 font-bold">{sub}</div>}</div>); }
        function Leaderboard({ title, icon, players, valFunc, label }) { return (<div className="bento-card h-full"><div className="flex items-center gap-2 mb-4 border-b border-white/5 pb-2"><span className="text-lg">{icon}</span><h3 className="text-sm font-black uppercase text-zinc-400 tracking-wider">{title}</h3></div><div className="space-y-1">{players.map((p, i) => (<div key={i} className="leader-row"><div className="flex items-center gap-2"><span className="font-black text-zinc-600 w-4">{i+1}</span><span className="text-xs font-bold text-zinc-300">{p.name.split(' ')[0]} {p.name.split(' ')[1][0]}.</span></div><div className="flex items-end"><span className="text-gold font-black text-sm">{valFunc(p)}</span>{i===0 && <span className="text-[8px] text-zinc-600 ml-1">{label}</span>}</div></div>))}</div></div>); }
        function InteractiveCourt({ data, onClick, mode }) { const getFill = (key) => { const z=data[key]||{m:0,x:0},t=z.m+z.x; if(t===0)return 'transparent'; return (z.m/t)>=0.4?'rgba(34,197,94,0.6)':'rgba(239,68,68,0.6)'; }; return (<div className="relative max-w-[350px] mx-auto select-none"><svg viewBox="0 0 100 94" className="court-svg"><rect width="100" height="94" fill="#111" stroke="#333"/><path d="M 35,94 L 35,55 L 65,55 L 65,94 Z" className="zone" fill={getFill('paint')} onClick={()=>onClick('paint',mode==='make')}/><path d="M 10,94 L 10,15 Q 50,-15 90,15 L 90,94" fill="none" stroke="#555" strokeWidth="1" strokeDasharray="4,4" pointerEvents="none"/><path d="M 10,55 L 35,55 L 35,94 L 10,94 Z" className="zone" onClick={()=>onClick('mid_l',mode==='make')} fill={getFill('mid_l')}/><path d="M 65,55 L 90,55 L 90,94 L 65,94 Z" className="zone" onClick={()=>onClick('mid_r',mode==='make')} fill={getFill('mid_r')}/><path d="M 35,55 L 35,30 L 65,30 L 65,55 Z" className="zone" onClick={()=>onClick('mid_c',mode==='make')} fill={getFill('mid_c')}/><path d="M 0,94 L 0,60 L 10,60 L 10,94 Z" className="zone" onClick={()=>onClick('corn_l',mode==='make')} fill={getFill('corn_l')}/><path d="M 90,94 L 90,60 L 100,60 L 100,94 Z" className="zone" onClick={()=>onClick('corn_r',mode==='make')} fill={getFill('corn_r')}/><path d="M 0,60 L 0,0 L 30,0 L 35,30 L 10,55 Z" className="zone" onClick={()=>onClick('wing_l',mode==='make')} fill={getFill('wing_l')}/><path d="M 100,60 L 100,0 L 70,0 L 65,30 L 90,55 Z" className="zone" onClick={()=>onClick('wing_r',mode==='make')} fill={getFill('wing_r')}/><path d="M 30,0 L 70,0 L 65,30 L 35,30 Z" className="zone" onClick={()=>onClick('top',mode==='make')} fill={getFill('top')}/><text x="50" y="85" className="zone-label" fill="white" fontSize="4">PAINT</text></svg></div>); }
        function HeatMapCourt({ data }) { const getFill = (key) => { const z=data[key]||{m:0,x:0},t=z.m+z.x; if(t===0) return 'rgba(255,255,255,0.05)'; const pct=z.m/t; if(pct>=0.5)return 'rgba(34,197,94,0.7)'; if(pct>=0.4)return 'rgba(59,130,246,0.7)'; if(pct>=0.3)return 'rgba(234,179,8,0.7)'; return 'rgba(239,68,68,0.7)'; }; return (<div className="relative max-w-[350px] mx-auto select-none"><svg viewBox="0 0 100 94" className="court-svg"><rect width="100" height="94" fill="#000" stroke="#333"/><path d="M 35,94 L 35,55 L 65,55 L 65,94 Z" fill={getFill('paint')} stroke="black" strokeWidth="0.5" /><path d="M 10,94 L 10,15 Q 50,-15 90,15 L 90,94" fill="none" stroke="#444" strokeWidth="1" strokeDasharray="4,4" /><path d="M 10,55 L 35,55 L 35,94 L 10,94 Z" fill={getFill('mid_l')} stroke="black" strokeWidth="0.5"/><path d="M 65,55 L 90,55 L 90,94 L 65,94 Z" fill={getFill('mid_r')} stroke="black" strokeWidth="0.5"/><path d="M 35,55 L 35,30 L 65,30 L 65,55 Z" fill={getFill('mid_c')} stroke="black" strokeWidth="0.5"/><path d="M 0,94 L 0,60 L 10,60 L 10,94 Z" fill={getFill('corn_l')} stroke="black" strokeWidth="0.5"/><path d="M 90,94 L 90,60 L 100,60 L 100,94 Z" fill={getFill('corn_r')} stroke="black" strokeWidth="0.5"/><path d="M 0,60 L 0,0 L 30,0 L 35,30 L 10,55 Z" fill={getFill('wing_l')} stroke="black" strokeWidth="0.5"/><path d="M 100,60 L 100,0 L 70,0 L 65,30 L 90,55 Z" fill={getFill('wing_r')} stroke="black" strokeWidth="0.5"/><path d="M 30,0 L 70,0 L 65,30 L 35,30 Z" fill={getFill('top')} stroke="black" strokeWidth="0.5"/>{ZONES.map(z=>{const d=data[z]||{m:0,x:0},t=d.m+d.x;if(t<1)return null;const pct=Math.round((d.m/t)*100);const pos={paint:[50,80],mid_l:[22,75],mid_r:[78,75],mid_c:[50,45],corn_l:[5,80],corn_r:[95,80],wing_l:[15,30],wing_r:[85,30],top:[50,20]}[z];return <text key={z} x={pos[0]} y={pos[1]} fill="white" fontSize="3" fontWeight="900" textAnchor="middle">{pct}%</text>})}</svg></div>); }
        function StatBox({label, val, color}) { return (<div className="bento-card text-center py-4"><div className="text-[9px] font-black uppercase text-zinc-500 tracking-widest mb-1">{label}</div><div className={`text-2xl font-black italic tracking-tighter ${color||'text-white'}`}>{val}</div></div>); }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
