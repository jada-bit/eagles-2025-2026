<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eagles Basketball | Cloud Dashboard</title>
    <!-- Core UI & Icons -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- React & Babel -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Firebase Compat (Most stable for single-file GitHub Pages) -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <style>
        :root { --eagle-gold: #FFB81C; --eagle-black: #000000; }
        .bg-gold { background-color: var(--eagle-gold); }
        .text-gold { color: var(--eagle-gold); }
        input[type="number"]::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        
        .stat-input { width: 45px; background: #111; border: 1px solid #333; border-radius: 4px; padding: 6px; text-align: center; color: white; font-size: 0.9rem; font-weight: 800; }
        .stat-input:focus { border-color: var(--eagle-gold); outline: none; background: #222; }
        
        /* Perfected Half-Court Geometry */
        .court-container { 
            position: relative; width: 100%; max-width: 480px; aspect-ratio: 50/47; 
            background: #0d0d0d; border: 2px solid #333; margin: 0 auto; border-radius: 12px; overflow: hidden;
            box-shadow: inset 0 0 50px rgba(0,0,0,0.8);
        }
        .court-line { position: absolute; background: rgba(255,255,255,0.15); pointer-events: none; }
        .baseline { bottom: 0; left: 0; width: 100%; height: 2px; }
        .the-key { bottom: 0; left: 50%; transform: translateX(-50%); width: 24%; height: 35%; border: 2px solid rgba(255,255,255,0.15); border-bottom: none; }
        .free-throw-circle { position: absolute; bottom: 23.5%; left: 50%; transform: translateX(-50%); width: 24%; aspect-ratio: 1; border: 2px solid rgba(255,255,255,0.15); border-radius: 50%; }
        
        /* 3PT Arc: Peak Aligned with Circle Peak */
        .three-point-arc { 
            position: absolute; bottom: -35%; left: 7%; right: 7%; height: 71%; 
            border: 2px solid rgba(255,255,255,0.25); border-radius: 50%; pointer-events: none; 
        }
        .three-point-straight-l { bottom: 0; left: 7%; width: 2px; height: 12%; }
        .three-point-straight-r { bottom: 0; right: 7%; width: 2px; height: 12%; }
        .rim { bottom: 5%; left: 50%; transform: translateX(-50%); width: 6%; aspect-ratio: 1; border: 2px solid #e11d48; border-radius: 50%; position: absolute; }

        .court-zone { position: absolute; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: all 0.2s; border-radius: 8px; z-index: 20; }
        .zone-label { font-size: 8px; font-weight: 900; color: #555; text-transform: uppercase; margin-bottom: 2px; pointer-events: none; }
        .zone-input { width: 32px; font-size: 10px; background: black; border: 1px solid #444; color: white; text-align: center; border-radius: 3px; font-weight: bold; }

        /* Tactical Zone Positioning */
        .z-paint { bottom: 5%; left: 32%; width: 36%; height: 30%; }
        .z-ml { bottom: 12%; left: 16%; width: 14%; height: 25%; }
        .z-mr { bottom: 12%; right: 16%; width: 14%; height: 25%; }
        .z-3lc { bottom: 2%; left: 0.5%; width: 6%; height: 15%; }
        .z-3rc { bottom: 2%; right: 0.5%; width: 6%; height: 15%; }
        .z-3lw { bottom: 32%; left: 1%; width: 12%; height: 25%; }
        .z-3rw { bottom: 32%; right: 1%; width: 12%; height: 25%; }
        .z-3t { bottom: 46%; left: 30%; width: 40%; height: 20%; }

        /* Giant Game Log UI */
        .log-card { background: #000; border: 1px solid #222; border-radius: 2.5rem; overflow: hidden; margin-bottom: 2rem; border-left: 10px solid var(--eagle-gold); }
        .log-score-text { font-size: 3rem; font-weight: 900; font-style: italic; letter-spacing: -0.05em; color: white; line-height: 1; }
        .log-result-box { width: 4.5rem; height: 4.5rem; border-radius: 1.25rem; display: flex; align-items: center; justify-content: center; font-size: 2rem; font-weight: 900; }
        .clipboard-card { background: #080808; border: 1px solid #1a1a1a; border-top: 4px solid var(--eagle-gold); border-radius: 1.5rem; padding: 1.5rem; }
    </style>
</head>
<body class="bg-gray-950">
    <div id="root"></div>

    <script type="text/babel">
        // --- YOUR FIREBASE CONFIG ---
        const firebaseConfig = {
            apiKey: "AIzaSyA5H5SsumWG7bym_0EZ7jOlfWeswpSauhk",
            authDomain: "eagles-stats.firebaseapp.com",
            projectId: "eagles-stats",
            storageBucket: "eagles-stats.firebasestorage.app",
            messagingSenderId: "386723096734",
            appId: "1:386723096734:web:b50e343c703983e838b38f",
            measurementId: "G-4SQEXFWE0W"
        };

        // Init Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const appId = "eagles-stats-prod";

        const ROSTER = [
            {id: 5, name: "Natasha Mistry", pos: "PG"}, {id: 3, name: "Mikayla Sanders", pos: "PG"},
            {id: 22, name: "Christina Lisack", pos: "PG/G"}, {id: 1, name: "Brittney Tang", pos: "G"},
            {id: 2, name: "Kylie Mulcahy", pos: "G"}, {id: 4, name: "Lexi Guild", pos: "G"},
            {id: 10, name: "Reese Jackson", pos: "F"}, {id: 32, name: "Gia Comey", pos: "F"},
            {id: 23, name: "Olivia Dozier", pos: "G/F"}, {id: 44, name: "Olivia Fraser", pos: "G/F"},
            {id: 34, name: "Dani Cardona", pos: "C"}, {id: 15, name: "Alexa Troiano", pos: "C"}
        ];

        const SHOT_ZONES = [
            { id: 'paint', label: 'Paint' }, { id: 'ml', label: 'Mid L' }, { id: 'mr', label: 'Mid R' },
            { id: '3lc', label: '3L Corner' }, { id: '3lw', label: '3L Wing' }, { id: '3t', label: '3 Top' },
            { id: '3rw', label: '3R Wing' }, { id: '3rc', label: '3R Corner' }
        ];

        function App() {
            const [view, setView] = React.useState('entry');
            const [games, setGames] = React.useState([]);
            const [loading, setLoading] = React.useState(true);
            const [opponent, setOpponent] = React.useState('');
            const [oppScore, setOppScore] = React.useState(0);
            const [playerStats, setPlayerStats] = React.useState({});
            const [shotMap, setShotMap] = React.useState({
                eagles: SHOT_ZONES.reduce((acc, z) => ({ ...acc, [z.id]: { m: 0, x: 0 } }), {}),
                opp: SHOT_ZONES.reduce((acc, z) => ({ ...acc, [z.id]: { m: 0, x: 0 } }), {})
            });

            React.useEffect(() => {
                auth.signInAnonymously().catch(err => console.error(err));
                const unsubscribe = db.collection('artifacts').doc(appId).collection('public').doc('data').collection('games')
                    .onSnapshot((snapshot) => {
                        const docs = snapshot.docs.map(d => ({ id: d.id, ...d.data() }));
                        setGames(docs.sort((a, b) => new Date(b.date) - new Date(a.date)));
                        setLoading(false);
                    }, err => console.error(err));
                return () => unsubscribe();
            }, []);

            const saveGame = async () => {
                if (!opponent) return alert("Enter Opponent Name");
                let teamScore = 0;
                const stats = ROSTER.map(p => {
                    const s = playerStats[p.name] || {};
                    const score = (s.fg2m||0)*2 + (s.fg3m||0)*3 + (s.ftm||0);
                    teamScore += score;
                    return { ...p, ...s, pts: score };
                });
                await db.collection('artifacts').doc(appId).collection('public').doc('data').collection('games').add({
                    date: new Date().toLocaleDateString(),
                    opp: opponent, oppScore, teamScore, 
                    result: teamScore > oppScore ? 'W' : 'L',
                    stats, shotMap
                });
                alert("Cloud Sync Successful!"); setOpponent(''); setPlayerStats({}); setView('log');
            };

            const aggregates = React.useMemo(() => {
                const data = {};
                ROSTER.forEach(r => data[r.name] = { gp:0, pts:0, reb:0, mft:0, aft:0, m3:0, a3:0, m2:0, a2:0 });
                games.forEach(g => {
                    g.stats.forEach(s => {
                        if(!data[s.name]) return;
                        const p = data[s.name]; p.gp++; p.pts += s.pts; p.reb += s.reb;
                        p.mft += (s.ftm || 0); p.aft += (s.fta || 0);
                        p.m3 += (s.fg3m || 0); p.a3 += (s.fg3a || 0);
                        p.m2 += (s.fg2m || 0); p.a2 += (s.fg2a || 0);
                    });
                });
                return data;
            }, [games]);

            const ZoneInput = ({ team, zoneId }) => (
                <div className="flex gap-1 items-center">
                    <input type="number" className="zone-input text-gold" placeholder="M" 
                        onChange={e => {
                            const val = parseInt(e.target.value) || 0;
                            const newMap = JSON.parse(JSON.stringify(shotMap)); 
                            newMap[team][zoneId].m = val; setShotMap(newMap);
                        }} />
                    <input type="number" className="zone-input text-white/40" placeholder="X" 
                        onChange={e => {
                            const val = parseInt(e.target.value) || 0;
                            const newMap = JSON.parse(JSON.stringify(shotMap)); 
                            newMap[team][zoneId].x = val; setShotMap(newMap);
                        }} />
                </div>
            );

            if (loading) return (
                <div className="h-screen bg-black flex items-center justify-center text-gold font-black italic tracking-tighter text-2xl animate-pulse">
                    SYNCING EAGLES CLOUD...
                </div>
            );

            return (
                <div className="min-h-screen bg-gray-950 text-white font-sans selection:bg-gold selection:text-black">
                    <header className="bg-black border-b-4 border-gold p-6 flex justify-between items-center sticky top-0 z-50 shadow-2xl">
                        <div className="flex items-center gap-4">
                            <div className="bg-white w-10 h-10 rounded-xl flex items-center justify-center font-bold text-black border-2 border-gold shadow-lg rotate-3 text-2xl">ðŸ¦…</div>
                            <h1 className="text-2xl font-black italic uppercase tracking-tighter">Eagles <span className="text-gold">Cloud</span></h1>
                        </div>
                        <nav className="flex gap-1 bg-gray-900 p-1 rounded-full border border-gray-800">
                            {['entry', 'log', 'clipboard'].map(v => (
                                <button key={v} onClick={() => setView(v)} className={`px-6 py-2 rounded-full text-[10px] font-black uppercase transition-all ${view === v ? 'bg-gold text-black shadow-lg' : 'text-gray-500'}`}>{v}</button>
                            ))}
                        </nav>
                    </header>

                    <div className="max-w-7xl mx-auto p-4 md:p-8">
                        {view === 'entry' && (
                            <div className="space-y-8 animate-fadeIn">
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div className="bg-black border border-gray-800 p-6 rounded-3xl shadow-xl">
                                        <label className="text-[10px] font-black uppercase text-gold mb-2 block tracking-widest">Opponent</label>
                                        <input type="text" value={opponent} onChange={e => setOpponent(e.target.value)} placeholder="TEAM NAME" className="w-full bg-gray-900 border border-gray-800 p-4 rounded-xl outline-none focus:border-gold font-bold uppercase" />
                                    </div>
                                    <div className="bg-black border border-gray-800 p-6 rounded-3xl shadow-xl">
                                        <label className="text-[10px] font-black uppercase text-red-500 mb-2 block tracking-widest">Opponent Score</label>
                                        <input type="number" value={oppScore} onChange={e => setOppScore(e.target.value)} placeholder="0" className="w-full bg-gray-900 border border-gray-700 p-4 rounded-xl outline-none focus:border-red-500 text-2xl font-black" />
                                    </div>
                                </div>

                                <div className="bg-black border border-gray-800 rounded-[2.5rem] overflow-hidden shadow-2xl">
                                    <div className="overflow-x-auto">
                                        <table className="w-full text-left text-xs">
                                            <thead className="bg-gray-900 text-gold uppercase border-b border-gray-800 font-black">
                                                <tr>
                                                    <th className="p-4 sticky left-0 bg-gray-900 z-30 border-r border-gray-800">Player</th>
                                                    {['2PM','2PA','3PM','3PA','FTM','FTA','REB','AST','STL','BLK','TO'].map(h => <th key={h} className="p-2 text-center">{h}</th>)}
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {ROSTER.map(p => (
                                                    <tr key={p.id} className="border-b border-gray-900 hover:bg-white/5 transition-colors">
                                                        <td className="p-4 font-bold sticky left-0 bg-black border-r border-gray-800 whitespace-nowrap">
                                                            <span className="text-gold text-[10px] mr-2">{p.pos}</span> {p.name}
                                                        </td>
                                                        {['fg2m','fg2a','fg3m','fg3a','ftm','fta','reb','ast','stl','blk','to'].map(f => (
                                                            <td key={f} className="p-2 text-center">
                                                                <input type="number" className="stat-input" onChange={e => setPlayerStats({...playerStats, [p.name]: {...playerStats[p.name], [f]: parseInt(e.target.value)||0}})} />
                                                            </td>
                                                        ))}
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>

                                <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                                    <div className="bg-black border border-gray-800 p-8 rounded-[2.5rem] shadow-xl">
                                        <p className="text-center text-[10px] uppercase font-black mb-6 tracking-widest text-gray-500">Eagles Shot Map Entry</p>
                                        <div className="court-container">
                                            <div className="court-line baseline"></div><div className="court-line the-key"></div><div className="court-line free-throw-circle"></div><div className="court-line three-point-straight-l"></div><div className="court-line three-point-straight-r"></div><div className="three-point-arc"></div><div className="rim"></div>
                                            {SHOT_ZONES.map(z => <div key={z.id} className={`court-zone z-${z.id}`}><span className="zone-label">{z.label}</span><ZoneInput team="eagles" zoneId={z.id} /></div>)}
                                        </div>
                                    </div>
                                    <div className="bg-black border border-gray-800 p-8 rounded-[2.5rem] shadow-xl">
                                        <p className="text-center text-[10px] uppercase font-black mb-6 tracking-widest text-red-900">Opponent Shot Map Entry</p>
                                        <div className="court-container border-red-900/30">
                                            <div className="court-line baseline"></div><div className="court-line the-key"></div><div className="court-line free-throw-circle"></div><div className="court-line three-point-straight-l"></div><div className="court-line three-point-straight-r"></div><div className="three-point-arc"></div><div className="rim"></div>
                                            {SHOT_ZONES.map(z => <div key={z.id} className={`court-zone z-${z.id}`}><span className="zone-label text-red-900">{z.label}</span><ZoneInput team="opp" zoneId={z.id} /></div>)}
                                        </div>
                                    </div>
                                </div>
                                <button onClick={saveGame} className="w-full bg-gold text-black py-10 rounded-3xl font-black text-4xl uppercase shadow-2xl hover:scale-[1.02] transition-transform">Save Game to Cloud</button>
                            </div>
                        )}

                        {view === 'log' && (
                            <div className="space-y-6 animate-fadeIn">
                                <h2 className="text-4xl font-black italic uppercase text-gold mb-10">Season History</h2>
                                {games.length === 0 ? (
                                    <div className="py-40 text-center text-gray-700 uppercase font-black italic border-2 border-dashed border-gray-800 rounded-[3rem]">No Cloud Records Found.</div>
                                ) : (
                                    games.map(g => (
                                        <div key={g.id} className="log-card p-10 flex flex-col lg:flex-row justify-between items-center gap-10">
                                            <div className="flex items-center gap-10">
                                                <div className={`log-result-box bg-gray-950 border-2 border-gray-800 ${g.result === 'W' ? 'text-gold' : 'text-red-600'}`}>{g.result}</div>
                                                <div>
                                                    <div className="text-base text-gray-500 font-black uppercase tracking-[0.4em] mb-2 italic">{g.date}</div>
                                                    <div className="log-score-text uppercase">EAGLES {g.teamScore}, {g.opp} {g.oppScore}</div>
                                                </div>
                                            </div>
                                            <button onClick={() => {if(confirm("Delete Game?")) db.collection('artifacts').doc(appId).collection('public').doc('data').collection('games').doc(g.id).delete();}} className="text-red-500 border border-red-900 p-6 rounded-2xl hover:bg-red-900 hover:text-white transition-all">
                                                <lucide-icon name="trash-2"></lucide-icon> DELETE
                                            </button>
                                        </div>
                                    ))
                                )}
                            </div>
                        )}

                        {view === 'clipboard' && (
                            <div className="animate-fadeIn grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                                <div className="clipboard-card">
                                    <h3 className="text-lg font-black uppercase italic mb-4 text-gold border-b border-gray-900 pb-2">Top 3 Scorers</h3>
                                    {Object.entries(aggregates).map(([n,d]) => ({n, ...d})).sort((a,b)=>b.pts-a.pts).slice(0,3).map((p, i) => (
                                        <div key={i} className="flex justify-between p-2 mb-1 rounded bg-gray-900 border border-gray-800"><span className="text-xs font-bold">{p.n}</span><span className="font-black text-gold">{p.pts}</span></div>
                                    ))}
                                    <p className="text-[8px] uppercase font-black text-gray-600 mt-4">Average PPG</p>
                                    {Object.entries(aggregates).map(([n,d]) => ({n, ...d})).filter(x=>x.gp>0).sort((a,b)=>(b.pts/b.gp)-(a.pts/a.gp)).slice(0,3).map((p, i) => (
                                        <div key={i} className="flex justify-between p-1 border-b border-gray-900 text-[10px]"><span className="font-bold text-gray-400">{p.n}</span><span className="font-black">{(p.pts/p.gp).toFixed(1)}</span></div>
                                    ))}
                                </div>
                                <div className="clipboard-card">
                                    <h3 className="text-lg font-black uppercase italic mb-4 text-white border-b border-gray-900 pb-2">Top 3 Rebounders</h3>
                                    {Object.entries(aggregates).map(([n,d]) => ({n, ...d})).sort((a,b)=>b.reb-a.reb).slice(0,3).map((p, i) => (
                                        <div key={i} className="flex justify-between p-2 mb-1 rounded bg-gray-900 border border-gray-800"><span className="text-xs font-bold">{p.n}</span><span className="font-black text-white">{p.reb}</span></div>
                                    ))}
                                    <p className="text-[8px] uppercase font-black text-gray-600 mt-4">Average RPG</p>
                                    {Object.entries(aggregates).map(([n,d]) => ({n, ...d})).filter(x=>x.gp>0).sort((a,b)=>(b.reb/b.gp)-(a.reb/a.gp)).slice(0,3).map((p, i) => (
                                        <div key={i} className="flex justify-between p-1 border-b border-gray-900 text-[10px]"><span className="font-bold text-gray-400">{p.n}</span><span className="font-black">{(p.reb/p.gp).toFixed(1)}</span></div>
                                    ))}
                                </div>
                                <div className="clipboard-card">
                                    <h3 className="text-lg font-black uppercase italic mb-4 text-gold border-b border-gray-900 pb-2">Top 3 FT%</h3>
                                    {Object.entries(aggregates).map(([n,d]) => ({n, ...d, pct:d.aft>0?(d.mft/d.aft)*100:0})).filter(x=>x.aft>0).sort((a,b)=>b.pct-a.pct).slice(0,3).map((p, i) => (
                                        <div key={i} className="flex justify-between p-2 mb-1 rounded bg-gray-900 border border-gray-800">
                                            <span className="text-xs font-bold">{p.n}</span>
                                            <div className="text-right leading-none"><div className="font-black text-gold italic">{p.pct.toFixed(0)}%</div><div className="text-[7px] text-gray-600">{p.mft}/{p.aft}</div></div>
                                        </div>
                                    ))}
                                </div>
                                <div className="clipboard-card">
                                    <h3 className="text-lg font-black uppercase italic mb-4 text-white border-b border-gray-900 pb-2">Top 3 3PT%</h3>
                                    {Object.entries(aggregates).map(([n,d]) => ({n, ...d, pct:d.a3>0?(d.m3/d.a3)*100:0})).filter(x=>x.a3>0).sort((a,b)=>b.pct-a.pct).slice(0,3).map((p, i) => (
                                        <div key={i} className="flex justify-between p-2 mb-1 rounded bg-gray-900 border border-gray-800"><span className="text-xs font-bold">{p.n}</span><span className="font-black text-white">{p.pct.toFixed(1)}%</span></div>
                                    ))}
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
