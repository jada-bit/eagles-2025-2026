<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eagles Analytics - Player Profiles</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        :root { --gold: #FFB81C; --black: #050505; --red: #ef4444; --green: #22c55e; --zinc: #18181b; }
        body { background-color: var(--black); color: white; font-family: system-ui, -apple-system, sans-serif; -webkit-print-color-adjust: exact; }
        
        .bento-card { 
            background: rgba(30, 30, 30, 0.6); backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.08); border-radius: 16px; padding: 1.25rem; 
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.2); transition: transform 0.2s;
        }
        
        .nav-btn { font-size: 10px; font-weight: 800; text-transform: uppercase; padding: 10px 14px; border-radius: 99px; cursor: pointer; border: 1px solid transparent; transition: all 0.2s; white-space: nowrap; }
        .active-nav { background-color: var(--gold); color: black; box-shadow: 0 0 15px rgba(255, 184, 28, 0.3); }
        .inactive-nav { background: rgba(255,255,255,0.05); color: #888; }
        .inactive-nav:hover { background: rgba(255,255,255,0.1); color: white; }

        .stat-val { font-feature-settings: "tnum"; font-variant-numeric: tabular-nums; }
        .court-svg { width: 100%; display: block; margin: 0 auto; filter: drop-shadow(0 0 8px rgba(255,184,28,0.1)); }
        .zone { cursor: pointer; transition: 0.2s; opacity: 0.3; stroke: rgba(255,255,255,0.4); stroke-width: 0.8; fill: transparent; }
        .zone:hover { opacity: 0.6; stroke: white; }

        /* PRINT STYLES - Transforms Dark Mode to Scouting Report Paper */
        @media print {
            body { background: white; color: black; }
            .no-print { display: none !important; }
            .bento-card { background: white; border: 2px solid #000; color: black; box-shadow: none; break-inside: avoid; }
            .text-gold { color: #000 !important; }
            .text-zinc-500, .text-zinc-400 { color: #444 !important; }
            .bg-black { background: white; border: 1px solid #ccc; color: black; }
            input, select { border: 1px solid #ccc; color: black; }
            .print-header { display: block !important; border-bottom: 2px solid black; margin-bottom: 20px; padding-bottom: 10px; }
            .print-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        }
        .print-header { display: none; }
    </style>
</head>
<body>
    <div id="root">
        <div style="height: 100vh; display: flex; align-items: center; justify-content: center; color: #FFB81C; font-weight: bold; font-size: 24px; animation: pulse 2s infinite;">
            LOADING PLAYER PROFILES...
        </div>
    </div>

    <script type="text/babel">
        // --- CONFIG ---
        const ROSTER = [
            {id: 5, name: "Natasha Mistry", pos: "PG"}, {id: 3, name: "Mikayla Sanders", pos: "PG"}, 
            {id: 22, name: "Christina Lisack", pos: "PG/G"}, {id: 1, name: "Brittney Tang", pos: "G"},
            {id: 2, name: "Kylie Mulcahy", pos: "G"}, {id: 4, name: "Lexi Guild", pos: "G"},
            {id: 10, name: "Reese Jackson", pos: "F"}, {id: 32, name: "Gia Comey", pos: "F"}, 
            {id: 23, name: "Olivia Dozier", pos: "G/F"}, {id: 44, name: "Olivia Fraser", pos: "G/F"},
            {id: 34, name: "Dani Cardona", pos: "C"}, {id: 15, name: "Alexa Troiano", pos: "C"},
            {id: 0, name: "Bela Smith", pos: "G/F"}
        ];
        const STAT_FIELDS = ['fg2m','fg2a','fg3m','fg3a','ftm','fta','reb','ast','stl','blk','to'];
        const ZONES = ['paint', 'mid_l', 'mid_r', 'mid_c', 'corn_l', 'corn_r', 'wing_l', 'wing_r', 'top'];

        // --- APP ---
        function App() {
            const [view, setView] = React.useState('clipboard');
            const [games, setGames] = React.useState([]);
            const [loading, setLoading] = React.useState(true);
            const [db, setDb] = React.useState(null);

            // Profile State
            const [selectedPlayer, setSelectedPlayer] = React.useState(ROSTER[0].name);

            // Input State
            const [gameMeta, setGameMeta] = React.useState({ date: new Date().toISOString().split('T')[0], opp: '', oppScore: 0, venue: 'Home' });
            const [playerStats, setPlayerStats] = React.useState({});
            const [shotMap, setShotMap] = React.useState({ eagles: ZONES.reduce((a,z)=>({...a,[z]:{m:0,x:0}}), {}), opp: {} });
            const [playStats, setPlayStats] = React.useState([]);
            const [newPlayName, setNewPlayName] = React.useState('');
            const [shotMode, setShotMode] = React.useState('make');
            const [editId, setEditId] = React.useState(null);

            React.useEffect(() => {
                try {
                    const firebaseConfig = { apiKey: "AIzaSyA5H5SsumWG7bym_0EZ7jOlfWeswpSauhk", projectId: "eagles-stats", appId: "1:386723096734:web:b50e343c703983e838b38f" };
                    if(window.firebase && !firebase.apps.length) { firebase.initializeApp(firebaseConfig); }
                    const d = firebase.firestore();
                    setDb(d);
                    d.collection('games').orderBy('date', 'desc').onSnapshot(snap => {
                        setGames(snap.docs.map(doc => ({ id: doc.id, ...doc.data() })));
                        setLoading(false);
                    });
                } catch(e) { console.warn("Offline"); setLoading(false); }
            }, []);

            // --- DATA LOGIC ---
            const getPlayerData = (pName) => {
                const pGames = games.filter(g => g.stats.find(s => s.name === pName));
                const totals = { gp: pGames.length, pts:0, reb:0, ast:0, stl:0, blk:0, to:0, fg2m:0, fg2a:0, fg3m:0, fg3a:0, ftm:0, fta:0 };
                const highs = { pts:0, reb:0, ast:0, stl:0, blk:0, to:0 };
                
                pGames.forEach(g => {
                    const s = g.stats.find(stat => stat.name === pName);
                    if(s) {
                        const pts = ((s.fg2m||0)*2)+((s.fg3m||0)*3)+(s.ftm||0);
                        totals.pts += pts; totals.reb += (s.reb||0); totals.ast += (s.ast||0);
                        totals.stl += (s.stl||0); totals.blk += (s.blk||0); totals.to += (s.to||0);
                        totals.fg2m += (s.fg2m||0); totals.fg2a += (s.fg2a||0);
                        totals.fg3m += (s.fg3m||0); totals.fg3a += (s.fg3a||0);
                        totals.ftm += (s.ftm||0); totals.fta += (s.fta||0);

                        // Highs
                        if(pts > highs.pts) highs.pts = pts;
                        if((s.reb||0) > highs.reb) highs.reb = s.reb;
                        if((s.ast||0) > highs.ast) highs.ast = s.ast;
                        if((s.stl||0) > highs.stl) highs.stl = s.stl;
                        if((s.blk||0) > highs.blk) highs.blk = s.blk;
                    }
                });

                const gp = totals.gp || 1;
                return {
                    totals, highs, games: pGames,
                    avgs: {
                        ppg: (totals.pts/gp).toFixed(1),
                        rpg: (totals.reb/gp).toFixed(1),
                        apg: (totals.ast/gp).toFixed(1),
                        spg: (totals.stl/gp).toFixed(1),
                        bpg: (totals.blk/gp).toFixed(1),
                        topg: (totals.to/gp).toFixed(1)
                    },
                    pcts: {
                        fg: (totals.fg2a+totals.fg3a)>0 ? Math.round(((totals.fg2m+totals.fg3m)/(totals.fg2a+totals.fg3a))*100) : 0,
                        fg2: totals.fg2a>0 ? Math.round((totals.fg2m/totals.fg2a)*100) : 0,
                        fg3: totals.fg3a>0 ? Math.round((totals.fg3m/totals.fg3a)*100) : 0,
                        ft: totals.fta>0 ? Math.round((totals.ftm/totals.fta)*100) : 0,
                    }
                };
            };

            const saveGame = async () => {
                if(!db) return alert("Offline Mode");
                if(!gameMeta.opp) return alert("Enter Opponent Name");
                let tScore = 0;
                const stats = ROSTER.map(p => {
                    const s = playerStats[p.name] || {};
                    const pts = ((s.fg2m||0)*2)+((s.fg3m||0)*3)+(s.ftm||0);
                    tScore += pts;
                    return { ...p, ...s, pts };
                });
                const payload = { ...gameMeta, teamScore: tScore, stats, shotMap, playStats, result: tScore>gameMeta.oppScore?'W':'L', updatedAt: firebase.firestore.FieldValue.serverTimestamp() };
                try {
                    if(editId) await db.collection('games').doc(editId).update(payload);
                    else await db.collection('games').add(payload);
                    alert("Saved!"); setEditId(null); setView('clipboard');
                } catch(e) { alert("Error: "+e.message); }
            };
            const handlePlayUpdate = (index, points) => { const newPlays = [...playStats]; newPlays[index].att += 1; if (points > 0) { newPlays[index].made += 1; newPlays[index].pts += points; } setPlayStats(newPlays); };

            if(loading) return <div className="p-20 text-center text-gold font-bold">LOADING...</div>;

            const playerData = getPlayerData(selectedPlayer);
            const playerInfo = ROSTER.find(p => p.name === selectedPlayer);

            return (
                <div className="pb-24 max-w-7xl mx-auto p-4">
                    {/* NAV HEADER */}
                    <div className="flex flex-col md:flex-row justify-between items-center mb-6 bg-zinc-900 p-4 rounded-xl border border-white/10 sticky top-2 z-50 shadow-xl no-print">
                        <div className="flex items-center gap-2 mb-4 md:mb-0">
                            <span className="text-2xl">ü¶Ö</span>
                            <h1 className="text-xl font-black italic uppercase">Eagles <span className="text-gold">Analytics</span></h1>
                        </div>
                        <nav className="flex gap-1 overflow-x-auto w-full md:w-auto pb-1 no-scrollbar">
                            {['clipboard', 'new', 'profiles', 'stats', 'log'].map(t => (
                                <button key={t} onClick={()=>setView(t)} className={`nav-btn ${view===t?'active-nav':'inactive-nav'}`}>{t}</button>
                            ))}
                        </nav>
                    </div>

                    {/* --- VIEW: PROFILES (NEW) --- */}
                    {view === 'profiles' && (
                        <div className="animate-slideIn">
                            {/* ROSTER SELECTOR (No Print) */}
                            <div className="mb-8 overflow-x-auto pb-2 no-print">
                                <div className="flex gap-2">
                                    {ROSTER.map(p => (
                                        <button key={p.id} onClick={()=>setSelectedPlayer(p.name)} className={`px-4 py-2 rounded-lg text-xs font-bold uppercase whitespace-nowrap border transition ${selectedPlayer===p.name ? 'bg-white text-black border-white' : 'bg-black text-zinc-500 border-zinc-800 hover:border-zinc-600'}`}>
                                            #{p.id} {p.name}
                                        </button>
                                    ))}
                                </div>
                            </div>

                            {/* PRINT HEADER */}
                            <div className="print-header">
                                <h1 className="text-4xl font-black uppercase">Eagles Scouting Report</h1>
                                <p className="text-lg">Individual Performance Sheet</p>
                            </div>

                            {/* MAIN PROFILE CARD */}
                            <div className="space-y-6">
                                {/* HERO SECTION */}
                                <div className="bento-card relative overflow-hidden">
                                    <div className="absolute top-0 right-0 p-8 opacity-10 font-black italic text-9xl">{playerInfo.id}</div>
                                    <div className="relative z-10 flex flex-col md:flex-row justify-between items-start md:items-end gap-4">
                                        <div>
                                            <div className="flex items-center gap-3 mb-2">
                                                <span className="bg-gold text-black font-black text-sm px-2 py-1 rounded">#{playerInfo.id}</span>
                                                <span className="text-zinc-400 font-bold uppercase tracking-widest text-xs">{playerInfo.pos}</span>
                                            </div>
                                            <h2 className="text-4xl md:text-6xl font-black italic uppercase leading-none">{playerInfo.name}</h2>
                                            <div className="mt-2 text-sm font-bold text-zinc-500">{playerData.totals.gp} Games Played ‚Ä¢ {playerData.totals.pts} Total Pts</div>
                                        </div>
                                        <button onClick={()=>window.print()} className="no-print bg-white text-black px-6 py-2 rounded-full font-bold uppercase text-xs hover:bg-gold transition shadow-lg">üñ®Ô∏è Export PDF</button>
                                    </div>
                                </div>

                                {/* STATS GRID */}
                                <div className="grid grid-cols-2 md:grid-cols-6 gap-4">
                                    <StatBox label="PPG" val={playerData.avgs.ppg} color="text-gold" />
                                    <StatBox label="RPG" val={playerData.avgs.rpg} />
                                    <StatBox label="APG" val={playerData.avgs.apg} />
                                    <StatBox label="SPG" val={playerData.avgs.spg} />
                                    <StatBox label="FG%" val={playerData.pcts.fg + '%'} />
                                    <StatBox label="3PT%" val={playerData.pcts.fg3 + '%'} />
                                </div>

                                <div className="print-grid grid grid-cols-1 lg:grid-cols-2 gap-6">
                                    {/* SHOOTING SPLITS */}
                                    <div className="bento-card h-full">
                                        <h3 className="text-lg font-black uppercase text-gold mb-4 border-b border-white/10 pb-2">Shooting Splits</h3>
                                        <div className="space-y-4">
                                            <SplitBar label="Field Goal" make={playerData.totals.fg2m+playerData.totals.fg3m} att={playerData.totals.fg2a+playerData.totals.fg3a} pct={playerData.pcts.fg} />
                                            <SplitBar label="2-Point" make={playerData.totals.fg2m} att={playerData.totals.fg2a} pct={playerData.pcts.fg2} />
                                            <SplitBar label="3-Point" make={playerData.totals.fg3m} att={playerData.totals.fg3a} pct={playerData.pcts.fg3} />
                                            <SplitBar label="Free Throw" make={playerData.totals.ftm} att={playerData.totals.fta} pct={playerData.pcts.ft} />
                                        </div>
                                    </div>

                                    {/* SEASON HIGHS */}
                                    <div className="bento-card h-full">
                                        <h3 className="text-lg font-black uppercase text-gold mb-4 border-b border-white/10 pb-2">Season Records</h3>
                                        <div className="grid grid-cols-2 gap-4">
                                            <HighBox label="Points" val={playerData.highs.pts} />
                                            <HighBox label="Rebounds" val={playerData.highs.reb} />
                                            <HighBox label="Assists" val={playerData.highs.ast} />
                                            <HighBox label="Steals" val={playerData.highs.stl} />
                                            <HighBox label="Blocks" val={playerData.highs.blk} />
                                            <HighBox label="3PM (Game)" val={Math.max(...playerData.games.map(g=>g.stats.find(s=>s.name===selectedPlayer)?.fg3m||0), 0)} />
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* --- VIEW: CLIPBOARD (Existing) --- */}
                    {view === 'clipboard' && (
                        <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <div className="bento-card text-center"><div className="text-xs text-zinc-500 font-bold">RECORD</div><div className="text-4xl font-black italic">{games.filter(g=>g.result==='W').length}-{games.filter(g=>g.result==='L').length}</div></div>
                            <div className="bento-card text-center"><div className="text-xs text-zinc-500 font-bold">PPG</div><div className="text-4xl font-black text-gold italic">{games.length?(games.reduce((a,b)=>a+b.teamScore,0)/games.length).toFixed(1):0}</div></div>
                             <div className="col-span-2 bento-card flex items-center justify-center text-zinc-500 font-bold uppercase">Select "Profiles" for Player Reports</div>
                        </div>
                    )}

                    {/* --- VIEW: NEW GAME --- */}
                    {view === 'new' && (
                        <div className="space-y-6">
                            <div className="bento-card grid grid-cols-2 md:grid-cols-4 gap-4">
                                <div className="space-y-1"><label className="text-[9px] font-bold text-zinc-500 uppercase">Opponent</label><input className="w-full bg-black border border-zinc-700 p-2 rounded text-white font-bold" value={gameMeta.opp} onChange={e=>setGameMeta({...gameMeta, opp:e.target.value})} /></div>
                                <div className="space-y-1"><label className="text-[9px] font-bold text-zinc-500 uppercase">Opp Score</label><input type="number" className="w-full bg-black border border-zinc-700 p-2 rounded text-white font-bold" value={gameMeta.oppScore} onChange={e=>setGameMeta({...gameMeta, oppScore:parseInt(e.target.value)||0})} /></div>
                                <div className="space-y-1"><label className="text-[9px] font-bold text-zinc-500 uppercase">Date</label><input type="date" className="w-full bg-black border border-zinc-700 p-2 rounded text-white font-bold" value={gameMeta.date} onChange={e=>setGameMeta({...gameMeta, date:e.target.value})} /></div>
                                <div className="space-y-1"><label className="text-[9px] font-bold text-zinc-500 uppercase">Venue</label><select className="w-full bg-black border border-zinc-700 p-2 rounded text-white font-bold" value={gameMeta.venue} onChange={e=>setGameMeta({...gameMeta, venue:e.target.value})}><option>Home</option><option>Away</option></select></div>
                            </div>
                            <div className="grid grid-cols-1 lg:grid-cols-12 gap-6">
                                <div className="lg:col-span-4 bento-card border-t-4 border-gold">
                                    <h3 className="font-black text-gold uppercase mb-4">Playbook</h3>
                                    <div className="space-y-2">{playStats.map((p,i)=>(<div key={i} className="flex items-center gap-2 p-2 border-b border-white/5"><div className="flex-1 font-bold text-xs uppercase">{p.name}</div><button onClick={()=>handlePlayUpdate(i,0)} className="px-2 py-1 bg-zinc-800 rounded text-[10px] hover:bg-red-900/50">Stop</button><button onClick={()=>handlePlayUpdate(i,2)} className="px-2 py-1 bg-zinc-800 rounded text-[10px] hover:bg-blue-900/50">+2</button><button onClick={()=>handlePlayUpdate(i,3)} className="px-2 py-1 bg-zinc-800 rounded text-[10px] hover:bg-green-900/50">+3</button></div>))}</div>
                                    <div className="flex gap-2 mt-4"><input className="bg-black border border-zinc-700 rounded p-2 text-xs flex-1 text-white font-bold" placeholder="New Play..." value={newPlayName} onChange={e=>setNewPlayName(e.target.value)} /><button onClick={()=>{if(newPlayName){setPlayStats([...playStats,{id:Date.now(),name:newPlayName,att:0,made:0,pts:0}]);setNewPlayName('');}}} className="bg-gold text-black font-bold text-xs px-3 rounded uppercase">Add</button></div>
                                </div>
                                <div className="lg:col-span-8 bento-card">
                                    <div className="flex justify-between mb-4"><h3 className="font-black text-gold uppercase">Input</h3><div className="flex bg-black rounded border border-zinc-800 p-1"><button onClick={()=>setShotMode('make')} className={`px-3 py-1 text-[10px] font-black uppercase rounded ${shotMode==='make'?'bg-green-600 text-white':'text-zinc-500'}`}>Make</button><button onClick={()=>setShotMode('miss')} className={`px-3 py-1 text-[10px] font-black uppercase rounded ${shotMode==='miss'?'bg-red-600 text-white':'text-zinc-500'}`}>Miss</button></div></div>
                                    <div className="overflow-x-auto"><table className="w-full text-xs"><thead><tr className="text-zinc-500 border-b border-zinc-800"><th className="p-2 text-left">PLAYER</th>{STAT_FIELDS.map(f=><th key={f} className="p-1 uppercase text-center">{f.replace('fg','').replace('m','')}</th>)}</tr></thead><tbody>{ROSTER.map(p=>{const s=playerStats[p.name]||{};return(<tr key={p.id} className="border-b border-white/5"><td className="p-2 font-bold whitespace-nowrap">{p.name}</td>{STAT_FIELDS.map(f=><td key={f} className="p-1"><input type="number" className="stat-input" value={s[f]||''} onChange={e=>setPlayerStats({...playerStats,[p.name]:{...s,[f]:parseInt(e.target.value)||0}})}/></td>)}</tr>)})}</tbody></table></div>
                                </div>
                            </div>
                            <button onClick={saveGame} className="w-full py-4 bg-gold hover:bg-white text-black font-black uppercase text-xl rounded-xl shadow-lg transition-all">Save Game</button>
                        </div>
                    )}
                    
                    {view === 'stats' && <div className="bento-card text-center py-10">Stats View (See Previous Code)</div>}
                    {view === 'log' && <div className="grid gap-4">{games.map(g=><div key={g.id} className="bento-card flex justify-between items-center"><div><div className="text-xs font-bold text-zinc-500">{g.date}</div><div className="text-xl font-black italic">{g.result} vs {g.opp}</div></div><button onClick={()=>{setEditId(g.id);setGameMeta({date:g.date,opp:g.opp,oppScore:g.oppScore,venue:g.venue});setPlayStats(g.playStats||[]);const sm={};g.stats.forEach(s=>sm[s.name]=s);setPlayerStats(sm);setShotMap(g.shotMap);setView('new');}} className="bg-zinc-800 text-xs font-bold uppercase p-2 rounded hover:bg-white hover:text-black">Edit</button></div>)}</div>}
                </div>
            );
        }

        // --- SUB-COMPONENTS ---
        function StatBox({label, val, color}) { return (<div className="bento-card text-center py-4"><div className="text-[10px] font-black uppercase text-zinc-500 tracking-widest mb-1">{label}</div><div className={`text-3xl font-black italic tracking-tighter ${color||'text-white'}`}>{val}</div></div>); }
        function HighBox({label, val}) { return (<div className="bg-black/40 border border-white/5 p-3 rounded-lg text-center"><div className="text-[9px] font-bold text-zinc-500 uppercase">{label}</div><div className="text-2xl font-black text-white">{val}</div></div>); }
        function SplitBar({label, make, att, pct}) {
            return (
                <div>
                    <div className="flex justify-between text-xs font-bold mb-1"><span className="text-zinc-400 uppercase">{label}</span><span>{make}/{att} <span className={`ml-1 ${pct>=50?'text-green-500':(pct<30?'text-red-500':'text-gold')}`}>({pct}%)</span></span></div>
                    <div className="h-2 bg-black rounded-full overflow-hidden border border-zinc-800"><div style={{width: `${pct}%`}} className={`h-full ${pct>=40?'bg-green-500':'bg-zinc-600'}`}></div></div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
